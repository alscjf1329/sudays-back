#!/bin/bash

# λ£¨νΈ λ””λ ‰ν† λ¦¬ μ„¤μ •
if [ -z "$ROOT_DIR" ]; then
    ROOT_DIR="$(dirname "$(dirname "$(realpath "$0")")")"
fi

# κ°€μƒν™κ²½ μ²΄ν¬ λ° μƒμ„±
if [ ! -f "$ROOT_DIR/.venv/bin/activate" ]; then
    echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
    echo "β•‘ π”¨ κ°€μƒν™κ²½μ„ μƒμ„±ν•©λ‹λ‹¤...               β•‘"
    echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
    python -m venv "$ROOT_DIR/.venv"
fi

# κ°€μƒν™κ²½ ν™μ„±ν™”
echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
echo "β•‘ β¨ κ°€μƒν™κ²½μ„ ν™μ„±ν™”ν•©λ‹λ‹¤...             β•‘" 
echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
source "$ROOT_DIR/.venv/bin/activate"

# ν¨ν‚¤μ§€ μ„¤μΉ λ° μ—…κ·Έλ μ΄λ“
echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
echo "β•‘ π”„ ν¨ν‚¤μ§€λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤...             β•‘"
echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
python -m pip install --upgrade pip
pip install -r "$ROOT_DIR/requirements.txt"

# ν…μ¤νΈ μ£Όμ„ μ κ±°
# echo "ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤..."
# pytest "$ROOT_DIR/test/utils"
# if [ $? -ne 0 ]; then
#     echo "ν…μ¤νΈ μ‹¤ν¨! μμ„Έν• λ‚΄μ©μ€ μ„μ λ΅κ·Έλ¥Ό ν™•μΈν•μ„Έμ”."
#     read -p "κ³„μ†ν•λ ¤λ©΄ μ•„λ¬΄ ν‚¤λ‚ λ„λ¥΄μ„Έμ”..."
#     exit 1
# fi 